# DeepBookV3 개발자 가이드 (주니어용)

안녕하세요! 주니어 개발자 여러분을 위해 Sui의 온체인 중앙 리밋 오더북(CLOB)인 DeepBookV3의 기술 문서를 한국어로 번역하고, 핵심 개념을 더 쉽게 이해할 수 있도록 설명해 드릴게요.

DeepBookV3는 탈중앙화 거래소(DEX)의 핵심 엔진으로, 개발자들이 이 위에 다양한 금융 애플리케이션을 구축할 수 있게 해줍니다. 아래 각 문서의 내용을 통해 DeepBookV3의 SDK와 컨트랙트를 어떻게 활용할 수 있는지 알아보세요.

---

### 1. `design.mdx`: DeepBookV3 설계 구조

#### **🎯 핵심 개념 (주니어 개발자용)**

DeepBookV3의 전체적인 설계도라고 생각하면 쉽습니다. 세 가지 주요 부품으로 이루어져 있어요.

1.  **`Pool` (거래소 시장)**: SUI/USDC처럼 특정 토큰 쌍을 거래하는 시장 하나하나를 의미합니다. 여기가 바로 주문이 매칭되는 곳입니다.
2.  **`PoolRegistry` (풀 등록소)**: 똑같은 거래 쌍(예: SUI/USDC)이 중복으로 만들어지지 않도록 관리하는 역할을 합니다.
3.  **`BalanceManager` (자금 관리자)**: 사용자가 거래에 사용할 자금을 보관하는 개인 금고입니다. 이 금고 하나로 여러 `Pool`에서 거래할 수 있습니다.

`Pool` 객체는 다시 세 개의 작은 모듈로 나뉩니다.
*   **`Book` (오더북)**: 모든 매수/매도 주문을 기록하고 관리하는 장부입니다.
*   **`State` (상태)**: 거래 수수료, 거버넌스 규칙, 사용자 계정 정보 등 풀의 전반적인 상태를 저장합니다.
*   **`Vault` (금고)**: 거래가 체결되었을 때 실제 자금을 안전하게 이동시키는 역할을 합니다.

#### **주문이 체결되는 과정 (Place Limit Order Flow)**

1.  **사용자**: "SUI 100개를 1달러에 팔겠다"는 지정가 주문(Limit Order)을 냅니다.
2.  **`Pool`**: 주문을 접수하고 `Book`에게 전달합니다.
3.  **`Book`**:
    *   먼저, "SUI를 1달러 이상에 사겠다"는 주문이 있는지 찾아봅니다.
    *   매칭되는 주문이 있으면 즉시 거래를 체결시키고, `Fill`(체결 내역)을 생성합니다.
    *   남은 수량이 있다면, 오더북에 새로운 매도 주문으로 기록합니다.
4.  **`State`**: `Fill` 내역을 바탕으로 거래에 참여한 사용자들의 계정 정보를 업데이트하고, 발생한 수수료를 기록합니다.
5.  **`Vault`**: `State`의 계산에 따라 사용자의 `BalanceManager`에서 자금을 인출하거나 입금하며 실제 자금 이동을 완료합니다.

---

### 2. `balance-manager.mdx`: 자금 관리자

#### **🎯 핵심 개념 (주니어 개발자용)**

`BalanceManager`는 DeepBook 거래소에서 사용하는 여러분의 "거래용 지갑"입니다. 거래하고 싶은 토큰을 이 지갑에 입금(`deposit`)해두고, 거래가 끝나면 다시 여러분의 일반 지갑으로 출금(`withdraw`)할 수 있습니다.

#### **주요 기능 및 API**

*   **`new()` / `new_with_owner()`**: 새로운 `BalanceManager`를 생성합니다. 생성된 객체는 공유(share)해야 다른 사람이 볼 수 있습니다.
*   **`deposit()` / `withdraw()`**: `BalanceManager`에 자금을 입금하거나 출금합니다. 소유자만 호출할 수 있습니다.
*   **`mint_trade_cap()`**: 다른 주소(예: 자동 거래 봇)에게 거래할 수 있는 권한(`TradeCap`)만 부여합니다. 이 권한으로는 입출금이 불가능하여 안전합니다.
*   **`mint_deposit_cap()` / `mint_withdraw_cap()`**: 입금 또는 출금 권한만 따로 부여할 수 있습니다.
*   **`generate_proof_as_owner()` / `generate_proof_as_trader()`**: 거래를 실행하기 전에 `TradeProof`라는 "거래 증명서"를 발급받아야 합니다. 이 증명서는 해당 거래가 `BalanceManager`의 소유자에 의해 승인되었음을 보증하는 역할을 합니다.

---

### 3. `orders.mdx`: 주문 관리

#### **🎯 핵심 개념 (주니어 개발자용)**

거래소의 가장 기본적인 기능인 주문 생성, 수정, 취소에 대한 설명입니다. 모든 주문을 처리하려면 `BalanceManager`에 충분한 자금이 있어야 합니다.

#### **주요 기능 및 API**

*   **`place_limit_order()` (지정가 주문)**: 원하는 가격과 수량을 지정하여 주문을 제출합니다. (예: "비트코인을 5만 달러에 1개 매수")
*   **`place_market_order()` (시장가 주문)**: 가격을 지정하지 않고, 현재 시장의 가장 유리한 가격으로 즉시 체결되는 주문을 제출합니다.
*   **`modify_order()` (주문 수정)**: 아직 체결되지 않은 주문의 수량을 줄이거나 만료 시간을 단축할 수 있습니다. (수량 증가는 불가능하며, 취소 후 재주문해야 합니다.)
*   **`cancel_order()` (주문 취소)**: 대기 중인 주문을 취소합니다.
*   **`withdraw_settled_amounts()`**: 거래가 체결되어 정산된 자금을 `BalanceManager`로 인출합니다. 보통은 자동으로 처리되지만, 수동으로 호출할 수도 있습니다.

#### **주문 옵션**

*   `IMMEDIATE_OR_CANCEL` (IOC): 주문 즉시 체결되고, 남은 수량은 자동 취소됩니다.
*   `FILL_OR_KILL` (FOK): 주문 전체 수량이 즉시 체결되지 않으면, 주문 전체가 취소됩니다.
*   `POST_ONLY`: 이 주문은 시장가로 즉시 체결되지 않고, 오더북에만 등록됩니다. (메이커 주문 보장)

---

### 4. `swaps.mdx`: 스왑 (간편 거래)

#### **🎯 핵심 개념 (주니어 개발자용)**

오더북을 직접 다루는 것이 복잡하게 느껴지는 사용자를 위한 "간편 거래" 기능입니다. Uniswap처럼 한 토큰을 주고 다른 토큰을 즉시 받을 수 있습니다. `BalanceManager`를 설정할 필요 없이, 일반 `Coin` 객체로 바로 거래할 수 있어 편리합니다.

#### **주요 기능 및 API**

*   **`swap_exact_base_for_quote()`**: `base` 토큰(예: SUI)을 정확한 수량만큼 주고, 가능한 많은 `quote` 토큰(예: USDC)을 받습니다.
*   **`swap_exact_quote_for_base()`**: `quote` 토큰을 정확한 수량만큼 주고, 가능한 많은 `base` 토큰을 받습니다.
*   **`get_amount_out()` (시뮬레이션)**: 스왑을 실행하기 전에 예상 결과를 미리 확인해볼 수 있는 함수입니다.

---

### 5. `query-the-pool.mdx`: 풀 정보 조회

#### **🎯 핵심 개념 (주니어 개발자용)**

거래 `Pool`의 다양한 데이터를 읽어오는 "읽기 전용" 기능들입니다. 거래 UI를 만들거나, 데이터를 분석할 때 필수적입니다.

#### **주요 기능 및 API**

*   **`mid_price()`**: 현재 풀의 중간 가격(매수 호가와 매도 호가의 평균)을 조회합니다.
*   **`get_level2_range()` / `get_level2_ticks_from_mid()`**: 오더북의 현재 상태(가격대별 주문량)를 조회합니다.
*   **`get_quote_quantity_out()` / `get_base_quantity_out()`**: 특정 수량의 토큰을 거래했을 때 받게 될 토큰의 양을 시뮬레이션합니다. (스왑 예상 결과 확인)
*   **`account_open_orders()`**: 특정 `BalanceManager`가 해당 풀에 제출한 아직 체결되지 않은 주문 목록을 가져옵니다.
*   **`get_order()`**: 주문 ID를 이용해 특정 주문의 상세 정보를 조회합니다.
*   **`pool_trade_params()`**: 해당 풀의 현재 거래 수수료율과 스테이킹 요구량 같은 정책을 조회합니다.

---

### 6. `permissionless-pool.mdx`: 무허가 풀 생성

#### **🎯 핵심 개념 (주니어 개발자용)**

누구나 자신만의 새로운 거래 시장(`Pool`)을 만들 수 있는 기능입니다. 예를 들어, `MY_TOKEN`과 `USDC`를 거래하는 시장이 없다면, 여러분이 직접 만들 수 있습니다.

#### **주요 기능 및 API**

*   **`create_permissionless_pool()`**: 새로운 `Pool`을 생성합니다.
    *   **`tick_size`**: 가격의 최소 단위 (호가 단위)
    *   **`lot_size`**: 주문 수량의 최소 단위
    *   이 값들을 설정하여 새로운 시장의 거래 규칙을 정합니다.
*   **`add_deep_price_point()`**: 새로 만든 풀에서 거래 수수료를 DEEP 토큰으로 지불하고 싶을 때(20% 할인), DEEP 토큰의 가격 정보를 주기적으로 업데이트하기 위해 호출해야 하는 함수입니다.

---

### 7. `staking-governance.mdx`: 스테이킹과 거버넌스

#### **🎯 핵심 개념 (주니어 개발자용)**

DeepBook의 네이티브 토큰인 `DEEP`을 `Pool`에 스테이킹(예치)하면, 해당 풀의 운영에 참여하고 보상을 받을 수 있습니다.

#### **주요 기능 및 API**

*   **`stake()`**: `DEEP` 토큰을 풀에 스테이킹합니다. 스테이킹한 사용자는 수수료 할인 및 리베이트 혜택을 받을 수 있습니다.
*   **`unstake()`**: 스테이킹한 `DEEP` 토큰을 회수합니다.
*   **`submit_proposal()`**: 풀의 거래 수수료율 등을 변경하자는 제안을 제출합니다.
*   **`vote()`**: 다른 사람이 제출한 제안에 투표합니다.
*   **`claim_rebates()`**: 거래에 기여한 대가(메이커 리베이트)로 받은 보상을 수령합니다.

---

### 8. `flash-loans.mdx`: 플래시 론

#### **🎯 핵심 개념 (주니어 개발자용)**

담보 없이 자산을 빌리고, **바로 그 트랜잭션 안에서** 갚는 특별한 대출입니다. 주로 차익 거래(Arbitrage)와 같은 복잡한 디파이 전략에 사용됩니다. 만약 한 트랜잭션 내에서 빌린 자금을 갚지 못하면, 해당 트랜잭션 전체가 실패하므로 대출해주는 `Pool` 입장에서는 리스크가 없습니다.

#### **주요 기능 및 API**

*   **`borrow_flashloan_base()` / `borrow_flashloan_quote()`**: `base` 또는 `quote` 자산을 플래시 론으로 빌립니다.
*   **`return_flashloan_base()` / `return_flashloan_quote()`**: 빌렸던 자산을 풀에 다시 갚습니다. 이 함수가 호출되지 않으면 트랜잭션이 실패합니다.

이 문서들이 DeepBookV3를 이해하고 활용하는 데 도움이 되기를 바랍니다. 즐거운 개발 되세요!
